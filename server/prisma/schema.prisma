generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================= ENUMS =========================

enum EScalingType {
  Physical
  Magical
  Hybrid
}

enum EPetRole {
  Tank
  Mage
  Support
  Assassin
  Warrior
}

enum EElemental {
  Metal
  Wood
  Water
  Fire
  Earth
}

enum ERarity {
  Uncommon
  Common
  Rare
  Epic
  Legendary
  Mythic
  Limited
}

enum ETargetPosition {
  All
  Random
  Self
  LowestHP
  HighestHP
  Nearest
  Farthest
}

enum EEffectTarget {
  Ally
  Enemy
}

enum EEffect {
  Heal
  DOT
  BuffStat
  DebuffStat
  RemoveBuff
  RemoveDebuff
  Silence
  ReducedHealing
  LifeSteal
  Revive
}

enum EStat {
  Hp
  Mana
  Atk
  Def
}

// ========================= TABLES =========================

model User {
  id              String                 @id
  username        String                 @unique
  z_coin          Int                    @default(0)
  exp             Int                    @default(0)
  level           Int                    @default(0)
  avatar          String                 @default("https://bvntk1sxxrwdoxcc.public.blob.vercel-storage.com/spider-gwen-DLOjzOblyRzNGEngmQMOdf9VCWni6V.jpeg")
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  dailyActivities UserDailyActivities[]
  userPets        UserPet[]
  teams           Team[]
}

model UserDailyActivities {
  id              String                 @id @default(uuid())
  user_id         String
  daily           Int                    @default(0)
  hunt            Int                    @default(0)
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  user            User                   @relation(fields: [user_id], references: [id])
}

model Rarity {
  id              Int                    @id @default(autoincrement())
  name            String                 @unique
  mezon_emoji_id  String                 @unique
  type            ERarity?
  catch_rate      Float
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  pets      Pet[]
}

model AutoAttack {
  id              Int                    @id @default(autoincrement())
  pet_id          Int                    @unique
  name            String
  description     String?
  damage          Int
  scaling_type    EScalingType
  attack_position ETargetPosition
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  pet             Pet                    @relation(fields: [pet_id], references: [id])
}

model PassiveSkill {
  id              Int                    @id @default(autoincrement())
  pet_id          Int                    @unique
  name            String
  description     String?
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  effects         PassiveSkillEffect[]
  pet             Pet                    @relation(fields: [pet_id], references: [id])
}

model ActiveSkill {
  id                          Int                @id @default(autoincrement())
  pet_id                      Int                @unique
  name                        String
  description                 String?
  mana_cost                   Int
  scaling_type                EScalingType?
  damage                      Int?
  attack_position             ETargetPosition?
  created_at                  DateTime           @default(now())
  updated_at                  DateTime           @default(now())          @updatedAt         

  effects                     ActiveSkillEffect[]
  pet                         Pet                @relation(fields: [pet_id], references: [id])
}

model ActiveSkillEffect {
  id                          Int                @id @default(autoincrement())
  active_skill_id             Int                
  name                        String
  description                 String?
  effect_target               EEffectTarget
  effect_target_position      ETargetPosition
  effect                      EEffect
  effect_stat                 EStat?
  scaling_type                EScalingType?
  duration                    Int                @default(1)
  value                       Int                @default(0)
  created_at                  DateTime           @default(now())
  updated_at                  DateTime           @default(now())          @updatedAt     

  activeSkill                 ActiveSkill        @relation(fields: [active_skill_id], references: [id])
}

model PassiveSkillEffect {
  id                          Int                @id @default(autoincrement())
  passive_skill_id            Int                
  name                        String
  description                 String?
  effect_target               EEffectTarget
  effect_target_position      ETargetPosition
  effect                      EEffect
  effect_stat                 EStat?
  value                       Int                @default(0)
  created_at                  DateTime           @default(now())
  updated_at                  DateTime           @default(now())          @updatedAt

  passiveSkill                PassiveSkill       @relation(fields: [passive_skill_id], references: [id])
}

model Statistics {
  id              Int                    @id @default(autoincrement())
  name            String
  scaling_type    EScalingType
  role            EPetRole
  element_type    EElemental?
  rarity          ERarity
  hp              Int
  mana            Int
  ad              Int
  ap              Int
  ar              Int
  mr              Int
  hp_per_level    Int
  ad_per_level    Int
  ap_per_level    Int
  ar_per_level    Int
  mr_per_level    Int 
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  pets            Pet[]
}

model Pet {
  id              Int                    @id @default(autoincrement())
  name            String                 @unique
  mezon_emoji_id  String                 @unique
  avatar          String?                
  description     String?
  statistic_id    Int
  rarity_id       Int
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  userPets        UserPet[]
  autoAttack      AutoAttack?
  passiveSkill    PassiveSkill?
  activeSkill     ActiveSkill?
  statistic       Statistics             @relation(fields: [statistic_id], references: [id])
  rarity          Rarity                 @relation(fields: [rarity_id], references: [id])
}

model UserPet {
  id              Int                    @id @default(autoincrement())
  user_id         String
  pet_id          Int
  nickname        String?
  level           Int                    @default(0)
  exp             Int                    @default(0)
  additional_hp   Int                    @default(0)
  additional_mana Int                    @default(0)
  additional_ad   Int                    @default(0)
  additional_ap   Int                    @default(0)
  additional_ar   Int                    @default(0)
  additional_mr   Int                    @default(0)
  count           Int                    @default(1)
  lock            Boolean                @default(false)
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  user            User                   @relation(fields: [user_id], references: [id])
  pet             Pet                    @relation(fields: [pet_id], references: [id])
  teamMembers     TeamMember[]

  @@unique([user_id, pet_id])
}

model Team {
  id              Int                    @id @default(autoincrement())
  user_id         String                 @unique
  name            String                 @unique
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())          @updatedAt         

  user            User                   @relation(fields: [user_id], references: [id])
  members         TeamMember[]
  battlesA        Battle[]               @relation("TeamA")
  battlesB        Battle[]               @relation("TeamB")
  wins            Battle[]               @relation("WinningTeam")
}

model TeamMember {
  id              Int                    @id @default(autoincrement())
  team_id         Int
  user_pet_id     Int
  position        Int
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())         @updatedAt         

  team            Team                   @relation(fields: [team_id], references: [id])
  userPet         UserPet                @relation(fields: [user_pet_id], references: [id])
}

model Battle {
  id              Int                    @id @default(autoincrement())
  team_a_id       Int
  team_b_id       Int
  winner_team_id  Int
  started_at      DateTime               @default(now())
  ended_at        DateTime?
  created_at      DateTime               @default(now())
  updated_at      DateTime               @default(now())         @updatedAt         

  teamA           Team                   @relation("TeamA", fields: [team_a_id], references: [id])
  teamB           Team                   @relation("TeamB", fields: [team_b_id], references: [id])
  winner          Team                   @relation("WinningTeam", fields: [winner_team_id], references: [id])
}
